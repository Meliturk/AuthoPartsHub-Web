@removeTagHelper Microsoft.AspNetCore.Mvc.TagHelpers.OptionTagHelper, Microsoft.AspNetCore.Mvc.TagHelpers
@model List<AutoPartsWeb.Models.ContactMessage>

@{
    ViewData["Title"] = "Mesajlar";
    Layout = "_AdminLayout";
}

<div class="d-flex align-items-center justify-content-between mb-3">
    <div>
        <h3 class="fw-bold mb-0"><i class="bi bi-chat-left-text me-2"></i>Mesajlar</h3>
        <div class="text-secondary small">Toplam @Model.Count kayıt</div>
    </div>
</div>

<form method="get" class="row g-2 align-items-center mb-3">
    <div class="col-md-3">
        <select class="form-select" name="status" onchange="this.form.submit()">
            <option value="">Durum (tümü)</option>
            <option value="Yeni" @(ViewBag.FilterStatus == "Yeni" ? "selected" : "")>Yeni</option>
            <option value="Okundu" @(ViewBag.FilterStatus == "Okundu" ? "selected" : "")>Okundu</option>
        </select>
    </div>
</form>

<div class="card border-0 shadow-sm rounded-4">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table align-middle mb-0">
                <thead class="text-secondary small">
                    <tr>
                        <th>#</th>
                        <th>Ad</th>
                        <th>Email</th>
                        <th>Telefon</th>
                        <th>Mesaj</th>
                        <th>Tarih</th>
                        <th>Durum</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var m in Model)
                    {
                        var isNew = (m.Status ?? "").Equals("Yeni", StringComparison.OrdinalIgnoreCase);
                        <tr>
                            <td>@m.Id</td>
                            <td>@m.Name</td>
                            <td>@m.Email</td>
                            <td>@(string.IsNullOrWhiteSpace(m.Phone) ? "-" : m.Phone)</td>
                            <td class="text-truncate" style="max-width:260px;">@m.Message</td>
                            <td>@m.CreatedAt.ToLocalTime().ToString("g")</td>
                            <td>
                                <span class="status-dot @(isNew ? "status-new" : "status-read")"></span>
                                @(isNew ? "Yeni" : "Okundu")
                            </td>
                            <td class="text-end d-flex gap-1 justify-content-end">
                                <a class="btn btn-sm btn-outline-secondary" asp-action="ComplaintDetail" asp-route-id="@m.Id">Detay</a>
                                @if (isNew)
                                {
                                    <form asp-action="UpdateComplaintStatus" method="post" class="d-inline">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="id" value="@m.Id" />
                                        <input type="hidden" name="status" value="Okundu" />
                                        <input type="hidden" name="returnUrl" value="@Context.Request.Path + Context.Request.QueryString" />
                                        <button class="btn btn-sm btn-outline-success" type="submit">Okundu</button>
                                    </form>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
